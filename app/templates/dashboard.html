<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Redirecting...</title>
</head>

<body>
    <script>
        const token = localStorage.getItem('access_token');
        if (!token) {
            window.location.replace('/login');
        } else {
            fetch('/api/user/me', {
                headers: { 'Authorization': 'Bearer ' + token }
            })
                .then(res => {
                    if (!res.ok) throw new Error("unauthorized");
                    return res.json();
                })
                .then(user => {
                    if (user.is_admin) {
                        window.location.replace('/admin/dashboard');
                    } else {
                        window.location.replace('/user/dashboard');
                    }
                })
                .catch(() => {
                    localStorage.clear();
                    window.location.replace('/login');
                });
        }
    </script>
</body>

</html>